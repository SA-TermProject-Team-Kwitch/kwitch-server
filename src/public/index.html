<!DOCTYPE html5>
<html lang="en">

<head>
    <title>Home</title>
    <link rel="shortcut icon" href="#">
</head>
<body>
    <style>
        .chat { height: 350px; overflow-y: scroll;}
        .line{margin-top: 10px; display: flex;}
        .chatbox {background: #eee; padding: 5px; max-width: 200px;}
        .mine {margin-left: auto;}
    </style>
    <h1>반갑습니다</h1>
    <h2 id="home">This is Home</h2>
    <div>
        <a>생성하실 채팅방을 써주세용</a>
        <input id = "createName" type = "text">
        <button id="link" onclick="create()">링크 스따또</button>
    </div>
    <div>
        <a>입장하실 채팅방을 써주세용</a>
        <input id = "roomName" type = "text">
        <button id="link" onclick="enter()">링크 스따또</button>
    </div>
    <div>
        <a>채팅 내용 써주세용</a>
        <input id="chat" type="text">
        <button id="chatlink" onclick="chat()">채팅 보내기</button>
    </div>
    <div>
        <a>강퇴할 유저를 써주세용</a>
        <input id="kick" type="text">
        <button id="chatlink" onclick="kick()">채팅 보내기</button>
    </div>
    <div>
        <a>채팅이 보일 공간입니다</a>
        <br>
        <div class = "chat">
        </div>

    </div>
    <div id="room">
        <form>
            <input type = "text">
            <button>Link</button>
        </form>
        
    </div>
    <div id="call">
        <div id="myStream">
            <video id="myCam" autoplay="true" width="400" height="400"></video>
            <button id="mute">Mute</button>
            <button id="cam">Cam</button>
            <select id="cameras"></select>
        </div>
    </div>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="script.js"></script>
</body>
<script>
    const button = document.getElementById("link");

    function enter(){
        const input = document.getElementById("roomName").value;
        console.log(input);

        socket.emit('enter_room', input, (result) => {
            const room = document.getElementById("home");
            room.textContent = input + "방에 접속 성공!!";
        });
    }

    function create(){
        const input = document.getElementById("createName").value;
        console.log(input);

        socket.emit('create_room', input, "재밌겠다", (result) => {
            const room = document.getElementById("home");
            room.textContent = input + "방에 생성 및 접속 성공!!";
        });
    }

    function kick(){
        const input = document.getElementById("kick").value;
        const roomName = document.getElementById("createName").value;
        if(roomName == null) roomName = document.getElementById("roomName").value;
        console.log(input);

        socket.emit('kick', input, roomName, (result) => {
            const room = document.getElementById("home");
            room.textContent = input + " 내보내기 성공!!";
        });
    }

    function addMessage(value, target){
        var template;
        if(target == 0) template = '<div class="line"><span class="chatbox mine">' + value + '</span></div>';
        else template = '<div class="line"><span class="chatbox">' + value + '</span></div>';
        document.querySelector('.chat').insertAdjacentHTML('beforeend', template);
    }

    function chat(){
        var value = document.querySelector('#chat').value
        socket.emit("send_message", value, document.getElementById("roomName").value, (ok) => {
            if(ok == true) addMessage(value, 0);
        });
    }

    socket.on("chatting_enter", (id)=>{
        addMessage(id + "님이 들어왔습니다.", 1);
    });

    socket.on("bye", (id) => {
        addMessage(id + "님이 나갔습니다.", 1);
    });

    socket.on("new_message", (msg, account, nickname)=>{
        addMessage(nickname + "(" + account + ")" + " : " + msg, 1);
    });

    socket.on("no_room", (msg) => {
        console.log(msg);
    })
</script>
</html>
